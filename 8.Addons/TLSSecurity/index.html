<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Tivadar GyÃ¶rgy Nagy">
    <link rel="canonical" href="http://u3d.as/5sb/8.Addons/TLSSecurity/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>About - Best HTTP/2 Documentation</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
	<link rel="stylesheet" href="../../css/prism.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
	<script src="../../js/prism.js"></script>
	
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "About", url: "#_top", children: [
              {title: "Features", url: "#features" },
              {title: "Setup Guide", url: "#setup-guide" },
              {title: "How To Detect TLS Certification Verification Failures", url: "#how-to-detect-tls-certification-verification-failures" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body class="line-numbers match-braces" >
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="CertificationManagerWindow/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="CertificationManagerWindow/" class="btn btn-xs btn-link">
        CertificationManagerWindow
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../7.GlobalTopics/ThreadSafety/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../7.GlobalTopics/ThreadSafety/" class="btn btn-xs btn-link">
        ThreadSafety
      </a>
    </div>
    
  </div>

    

    <h1 id="about">About</h1>
<p>Implementing a good certification validation isn't an easy task, but this addon aims even higher. It implements the same steps a browser does to ensure the communication over the negotiated connection is safe and secure. Additionally, provides a management window to easily manage trusted certificates, update and test them.
This addon implements all certification verification steps a browser normally do and additionally provides a management window to easily manage trusted certificates, update and test them.</p>
<p>Take a step further to improve the security of all protocols connecting through a TLS connection with a one line setup. Works with <strong>all</strong> protocols Best HTTP/2 supports.</p>
<p>All source code included. Requires the latest version of <a href="https://assetstore.unity.com/packages/tools/network/best-http-2-155981?aid=1101lfX8E">Best HTTP/2</a>. Link to the addon's store page: <a href="https://assetstore.unity.com/packages/tools/network/best-http-2-tls-security-addon-184441?aid=1101lfX8E">https://assetstore.unity.com/packages/tools/network/best-http-2-tls-security-addon-184441</a>.</p>
<h2 id="features">Features</h2>
<ul>
<li>Certificate Chain Verification as described in <a href="https://tools.ietf.org/html/rfc3280">RFC 3280</a></li>
<li>Revocation checking of leaf certificates using OCSP with optional soft and hard fail</li>
<li>Caching OCSP responses</li>
<li>Support for <a href="https://casecurity.org/2014/06/18/ocsp-must-staple/">OCSP Must-Staple</a></li>
<li>Trusted Root CA, Trusted Intermediate and Client Credentials management through an easy to use <a href="CertificationManagerWindow/">Certification Manager Window</a> to<ol>
<li>Update all certificates from a trusted source</li>
<li>Add custom certificates</li>
<li>Delete non-needed certificates</li>
</ol>
</li>
<li>Domain Name Matching</li>
<li><a href="https://comodosslstore.com/blog/what-is-ssl-tls-client-authentication-how-does-it-work.html">Client Authentication</a></li>
<li>Wide variety of options to configure almost every bits of the addon</li>
</ul>
<h2 id="setup-guide">Setup Guide</h2>
<p>This addon doesn't require any installation steps, but it's recommended to import after the Best HTTP/2 package.
After importing the package just must call one function on application startup:</p>
<pre><code class="language-csharp">#if !UNITY_WEBGL || UNITY_EDITOR
using BestHTTP.Addons.TLSSecurity;

TLSSecurity.Setup();
#endif
</code></pre>

<p>Calling <code>TLSSecurity.Setup()</code> going to set up the addon and installs itself as sets its TlsClient factory as the default one. One part of the setup phase is to load the databases into memory and write it to the application's persistent data path (with default settings) and unload the resource. 
This step needed as the databases going to open those files and read into memory only the required chunks. While it has some disk overhead, more complexity and can work on platforms and devices where it can create and write into a new file, it greatly reduces runtime memory requirements.
This step also done only once, when the files are there no resources going to be loaded and written. To make updating certification databases possible, a hash file is generated and compared in the Setup call, so even if the files are there but the hashes are different a new file going to be written.</p>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>Under WebGL BestHTTP/2 must use the underlying browser's XmlHTTPRequest implementation, all tls verification is done by the browser.</p>
</div>
<h2 id="how-to-detect-tls-certification-verification-failures">How To Detect TLS Certification Verification Failures</h2>
<p>If certification verification fails, the connection going to be terminated the HTTPReqest's State going to be HTTPRequestStates.Error. The request's Exception property is a reference to an exception containing more information about the issue:</p>
<pre><code class="language-csharp">void OnRequestFinished(HTTPRequest req, HTTPResponse resp)
{
    switch (req.State)
    {
        // The request finished without any problem.
        case HTTPRequestStates.Finished:
            if (resp.IsSuccess)
            {
                Debug.Log(&quot;Done!&quot;);
            }
            else
            {
                Debug.LogWarning(string.Format(&quot;Request finished Successfully, but the server sent an error. Status Code: {0}-{1} Message: {2}&quot;, resp.StatusCode, resp.Message, resp.DataAsText));
            }
            break;

        // The request finished with an unexpected error. The request's Exception property may contain more info about the error.
        case HTTPRequestStates.Error:
            Debug.LogError(&quot;Request Finished with Error! &quot; + (req.Exception != null ? (req.Exception.Message + &quot;\n&quot; + req.Exception.StackTrace) : &quot;No Exception&quot;));

            TlsFatalAlert tlsException = req.Exception as TlsFatalAlert;
            if (tlsException != null)
            {
                Debug.LogException(tlsException);
            }
            break;

        // The request aborted, initiated by the user.
        case HTTPRequestStates.Aborted:
            Debug.LogWarning(&quot;Request Aborted!&quot;);
            break;

        // Connecting to the server is timed out.
        case HTTPRequestStates.ConnectionTimedOut:
            Debug.LogError(&quot;Connection Timed Out!&quot;);
            break;

        // The request didn't finished in the given time.
        case HTTPRequestStates.TimedOut:
            Debug.LogError(&quot;Processing the request Timed Out!&quot;);
            break;
    }
}
</code></pre>

<p>For a failed TLS verification, it should produce two log lines, something like this: <img alt="TLS Error Log Entries" src="media/TLSErrorLogEntries.png" /></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="CertificationManagerWindow/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="CertificationManagerWindow/" class="btn btn-xs btn-link">
        CertificationManagerWindow
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../7.GlobalTopics/ThreadSafety/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../7.GlobalTopics/ThreadSafety/" class="btn btn-xs btn-link">
        ThreadSafety
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>