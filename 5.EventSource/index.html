<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Tivadar György Nagy">
    <link rel="canonical" href="http://u3d.as/5sb/5.EventSource/">
    <link rel="shortcut icon" href="../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Server-Sent Events (EventSource) - Best HTTP/2 Documentation</title>
    <link href="../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
	<link rel="stylesheet" href="../css/prism.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/bootstrap-3.3.7.min.js"></script>
	<script src="../js/prism.js"></script>
	
    
    <base target="_top">
    <script>
      var base_url = '..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Server-Sent Events (EventSource)", url: "#_top", children: [
              {title: "The EventSource class", url: "#the-eventsource-class" },
              {title: "Properties", url: "#properties" },
              {title: "Events", url: "#events" },
              {title: "Functions", url: "#functions" },
              {title: "The Message class", url: "#the-message-class" },
          ]},
        ];

    </script>
    <script src="../js/base.js"></script> 
</head>

<body class="line-numbers match-braces" >
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../6.SignalRCore/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../6.SignalRCore/" class="btn btn-xs btn-link">
        SignalR Core
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../4.SignalR/4.Hubs/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../4.SignalR/4.Hubs/" class="btn btn-xs btn-link">
        Hubs
      </a>
    </div>
    
  </div>

    

    <h1 id="server-sent-events-eventsource">Server-Sent Events (EventSource)</h1>
<p>The Server-Sent Events is a one-way string-based protocol. Data comes from the server, and there are no option to send anything to the server. It’s implemented using the <a href="http://www.w3.org/TR/eventsource/">latest draft</a>.
While the protocol’s name is Server-Sent Events, the class itself is named EventSource.</p>
<p>When an error occurs, the plugin will try to reconnect once sending the LastEventId to let the server send any buffered message that we should receive.</p>
<h2 id="the-eventsource-class">The EventSource class</h2>
<p>The EventSource class is located in the BestHTTP.ServerSentEvents namespace:</p>
<pre><code class="language-csharp">using BestHTTP.ServerSentEvents;

var sse = new EventSource(new Uri(&quot;http://server.com&quot;));
</code></pre>

<h2 id="properties">Properties</h2>
<p>These are the publicly exposed properties of the EventSource class:</p>
<ul>
<li><strong>Uri</strong>: This is the endpoint where the protocol tries to connect to. It’s set through the constructor.</li>
<li><strong>State</strong>: The current state of the EventSource object.</li>
<li>*<em>ReconnectionTime</em>: How much time to wait to try to do a reconnect attempt. It’s default value is 2 sec.</li>
<li><strong>LastEventId</strong>: The last received event’s id. It will be null, if no event id received at all.</li>
<li><strong>InternalRequest</strong>: The internal HTTPRequest object that will be sent out in the Open function.</li>
</ul>
<h2 id="events">Events</h2>
<ul>
<li><strong>OnOpen</strong>: It’s called when the protocol is successfully upgraded.</li>
</ul>
<pre><code class="language-csharp">eventSource.OnOpen += OnEventSourceOpened;

void OnEventSourceOpened(EventSource source)
{
    Debug.log(&quot;EventSource Opened!&quot;);
}
</code></pre>

<ul>
<li><strong>OnMessage</strong>: It’s called when the client receives a new message from the server. This function will receive a Message object that contains the payload of the message in the Data property. This event is called every time the client receives a message, even when the message has a valid Event name, and we assigned an event handler to this event!</li>
</ul>
<pre><code class="language-csharp">eventSource.OnMessage += OnEventSourceMessage;

void OnEventSourceMessage(EventSource source, Message msg)
{
    Debug.log(&quot;Message: &quot; + msg.Data);
}
</code></pre>

<ul>
<li><strong>OnError</strong>: Called when an error encountered while connecting to the server, or while processing the data stream.</li>
</ul>
<pre><code class="language-csharp">eventSource.OnError += OnEventSourceError;

void OnEventSourceError(EventSource source, string error)
{
    Debug.log(&quot;Error: &quot; + error);
}
</code></pre>

<ul>
<li><strong>OnRetry</strong>: This function is called before the plugin will try to reconnect to the server. If the function returns false, no attempt will be made and the EventSource will be closed.</li>
</ul>
<pre><code class="language-csharp">eventSource.OnRetry += OnEventSourceRetry;

bool OnEventSourceRetry(EventSource source)
{
    // disable retry
    return false;
}
</code></pre>

<ul>
<li><strong>OnClosed</strong>: This event will be called when the EventSource closed.</li>
</ul>
<pre><code class="language-csharp">eventSource.OnClosed += OnEventSourceClosed;

void OnEventSourceClosed(EventSource source)
{
    Debug.log(&quot;EventSource Closed!&quot;);
}
</code></pre>

<ul>
<li><strong>OnStateChanged</strong>: Called every time when the State property changes.</li>
</ul>
<pre><code class="language-csharp">eventSource.OnStateChanged += OnEventSourceStateChanged;

void OnEventSourceStateChanged(EventSource source, States oldState, States newState)
{
    Debug.log(string.Format(&quot;State Changed {0} =&gt; {1}&quot;, oldState, newState)));
}
</code></pre>

<ul>
<li><strong>OnComment</strong>: This event is called for comments received from the server.</li>
</ul>
<pre><code class="language-csharp">eventSource.OnComment += OnEventSourceComment;

void OnEventSourceComment(EventSource source, string comment)
{
    Debug.log(string.Format(&quot;Comment: {0}&quot;, comment)));
}
</code></pre>

<h2 id="functions">Functions</h2>
<p>These are the public functions of the EventSource object.</p>
<ul>
<li><strong>Open</strong>: Calling this function the plugin will start to connect to the server and upgrade to the Server-Sent Events protocol.</li>
</ul>
<pre><code class="language-csharp">EventSource eventSource = new EventSource(new Uri(&quot;http://server.com&quot;));
eventSource.Open();
</code></pre>

<ul>
<li><strong>On</strong>: Using this function clients can subscribe to events.</li>
</ul>
<pre><code class="language-csharp">eventSource.On(&quot;userLogon&quot;, OnUserLoggedIn);

void OnUserLoggedIn(EventSource source, Message msg)
{
    Debug.log(msg.Data);
}
</code></pre>

<ul>
<li><strong>Off</strong>: It can be used to unsubscribe from an event.</li>
</ul>
<pre><code class="language-csharp">eventSource.Off(&quot;userLogon&quot;);
</code></pre>

<ul>
<li><strong>Close</strong>: This function will start to close the EventSource object.</li>
</ul>
<pre><code class="language-csharp">eventSource.Close();
</code></pre>

<h2 id="the-message-class">The Message class</h2>
<p>The Message class is a logical unit that contains all the information that a server can send.</p>
<h3 id="properties_1">Properties</h3>
<ul>
<li><strong>Id</strong>: Id of the sent event. Can be null, if no id sent. It’s used by the plugin.</li>
<li><strong>Event</strong>: Name of the event. Can be null, if no event name sent.</li>
<li><strong>Data</strong>: The actual payload of the message.</li>
<li><strong>Retry</strong>: A server sent time that the plugin should wait before a reconnect attempt. It’s used by the plugin.</li>
</ul>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../6.SignalRCore/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../6.SignalRCore/" class="btn btn-xs btn-link">
        SignalR Core
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../4.SignalR/4.Hubs/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../4.SignalR/4.Hubs/" class="btn btn-xs btn-link">
        Hubs
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>