<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Tivadar GyÃ¶rgy Nagy">
    <link rel="canonical" href="http://u3d.as/5sb/6.SignalRCore/5.AzureSignalRService/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>How to connect to an Azure SignalR Service - Best HTTP/2 Documentation</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
	<link rel="stylesheet" href="../../css/prism.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
	<script src="../../js/prism.js"></script>
	
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "How to connect to an Azure SignalR Service", url: "#_top", children: [
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body class="line-numbers match-braces" >
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../7.GlobalTopics/BufferPool/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../7.GlobalTopics/BufferPool/" class="btn btn-xs btn-link">
        Buffer Pool
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../4.IRetryPolicy/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../4.IRetryPolicy/" class="btn btn-xs btn-link">
        Automatic reconnection and the IRetryPolicy interface
      </a>
    </div>
    
  </div>

    

    <h1 id="how-to-connect-to-an-azure-signalr-service">How to connect to an Azure SignalR Service</h1>
<p>Here's a sample implementation to connect to an Azure SignalR Serverice:</p>
<pre><code class="language-csharp">using System.Collections;
using System.Collections.Generic;
using UnityEngine;

using BestHTTP.SignalRCore;
using System;
using BestHTTP;

public class SignalRService : MonoBehaviour {

    // Use this for initialization
    void Start () {
        var conn = new HubConnection(new Uri(&quot;http://localhost:5000/chat&quot;), new JsonProtocol(new BestHTTP.SignalRCore.Encoders.LitJsonEncoder()));
        conn.AuthenticationProvider = new AzureSignalRServiceAuthenticator(conn);
        conn.OnConnected += OnConnected;

        conn.On&lt;string, string&gt;(&quot;BroadcastMessage&quot;, OnBroadcastMessage);

        conn.StartConnect();
    }

    private void OnBroadcastMessage(string name, string message)
    {
        Debug.LogFormat(&quot;[{0}]: {1}&quot;, name, message);
    }

    private void OnConnected(HubConnection hub)
    {
        hub.Send(&quot;BroadcastMessage&quot;, &quot;Best HTTP Client&quot;, &quot;Hello World!&quot;);
    }
}

public sealed class AzureSignalRServiceAuthenticator : IAuthenticationProvider
{
    /// &lt;summary&gt;
    /// No pre-auth step required for this type of authentication
    /// &lt;/summary&gt;
    public bool IsPreAuthRequired { get { return false; } }

#pragma warning disable 0067
    /// &lt;summary&gt;
    /// Not used event as IsPreAuthRequired is false
    /// &lt;/summary&gt;
    public event OnAuthenticationSuccededDelegate OnAuthenticationSucceded;

    /// &lt;summary&gt;
    /// Not used event as IsPreAuthRequired is false
    /// &lt;/summary&gt;
    public event OnAuthenticationFailedDelegate OnAuthenticationFailed;

#pragma warning restore 0067

    private HubConnection _connection;

    public AzureSignalRServiceAuthenticator(HubConnection connection)
    {
        this._connection = connection;
    }

    /// &lt;summary&gt;
    /// Not used as IsPreAuthRequired is false
    /// &lt;/summary&gt;
    public void StartAuthentication()
    { }

    /// &lt;summary&gt;
    /// Prepares the request by adding two headers to it
    /// &lt;/summary&gt;
    public void PrepareRequest(BestHTTP.HTTPRequest request)
    {
        if (this._connection.NegotiationResult == null)
            return;

        // Add Authorization header to http requests, add access_token param to the uri otherwise
        if (BestHTTP.Connections.HTTPProtocolFactory.GetProtocolFromUri(request.CurrentUri) == BestHTTP.Connections.SupportedProtocols.HTTP)
            request.SetHeader(&quot;Authorization&quot;, &quot;Bearer &quot; + this._connection.NegotiationResult.AccessToken);
        else
            request.Uri = PrepareUriImpl(request.Uri);
    }

    public Uri PrepareUri(Uri uri)
    {
        if (uri.Query.StartsWith(&quot;??&quot;))
        {
            UriBuilder builder = new UriBuilder(uri);
            builder.Query = builder.Query.Substring(2);

            return builder.Uri;
        }

        return uri;
    }

    private Uri PrepareUriImpl(Uri uri)
    {
        string query = string.IsNullOrEmpty(uri.Query) ? &quot;&quot; : uri.Query + &quot;&amp;&quot;;
        UriBuilder uriBuilder = new UriBuilder(uri.Scheme, uri.Host, uri.Port, uri.AbsolutePath, query + &quot;access_token=&quot; + this._connection.NegotiationResult.AccessToken);
        return uriBuilder.Uri;
    }
}
</code></pre>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When used with Azure Functions Invoke and other client to server messaging can be done through Azure Functions (HTTP requests). See <a href="https://docs.microsoft.com/en-us/azure/azure-signalr/signalr-concept-serverless-development-config#sending-messages-from-a-client-to-the-service">https://docs.microsoft.com/en-us/azure/azure-signalr/signalr-concept-serverless-development-config#sending-messages-from-a-client-to-the-service</a></p>
</div>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../7.GlobalTopics/BufferPool/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../7.GlobalTopics/BufferPool/" class="btn btn-xs btn-link">
        Buffer Pool
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../4.IRetryPolicy/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../4.IRetryPolicy/" class="btn btn-xs btn-link">
        Automatic reconnection and the IRetryPolicy interface
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>