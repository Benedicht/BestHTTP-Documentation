<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Tivadar GyÃ¶rgy Nagy">
    <link rel="canonical" href="http://u3d.as/5sb/6.SignalRCore/2.Authentication/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>The IAuthenticationProvider interface - Best HTTP/2 Documentation</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
	<link rel="stylesheet" href="../../css/prism.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
	<script src="../../js/prism.js"></script>
	
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "The IAuthenticationProvider interface", url: "#_top", children: [
          ]},
          {title: "Default Implementation", url: "#default-implementation", children: [
          ]},
          {title: "Using an IAuthenticationProvider implementation", url: "#using-an-iauthenticationprovider-implementation", children: [
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body class="line-numbers match-braces" >
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../3.Encoders/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../3.Encoders/" class="btn btn-xs btn-link">
        Encoders
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../1.HubConnection/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../1.HubConnection/" class="btn btn-xs btn-link">
        The HubConnection Class
      </a>
    </div>
    
  </div>

    

    <h1 id="the-iauthenticationprovider-interface">The IAuthenticationProvider interface</h1>
<p>To authenticate a SignalR Core session an <code>IAuthenticationProvider</code> implementation can be set to the hub connection's <code>AuthenticationProvider</code> property. The plugin implements a <code>DefaultAccessTokenAuthenticator</code> and uses it as the default authenticator.</p>
<p>The <code>IAuthenticationProvider</code> has the following properties and events:</p>
<ul>
<li><strong>IsPreAuthRequired</strong>: The authentication must be run before any request made to build up the SignalR protocol if this property is true.</li>
<li><strong>OnAuthenticationSucceded</strong>: This event must be called when the pre-authentication succeded. When IsPreAuthRequired is false, no-one will subscribe to this event.</li>
<li><strong>OnAuthenticationFailed</strong>: This event must be called when the pre-authentication failed. When IsPreAuthRequired is false, no-one will subscribe to this event.</li>
<li><strong>StartAuthentication</strong>: This function called once, when the before the SignalR negotiation begins. If IsPreAuthRequired is false, then this step will be skipped.</li>
<li><strong>PrepareRequest</strong>: This function will be called for every request before sending it.</li>
<li><strong>PrepareUri</strong>: This function can customize the given uri. If there's no intention to modify the uri, this function should return with the parameter.</li>
</ul>
<h1 id="default-implementation">Default Implementation</h1>
<p>Here's the implementation of the <code>DefaultAccessTokenAuthenticator</code>:</p>
<pre><code class="language-csharp">using System;

namespace BestHTTP.SignalRCore.Authentication
{
    public sealed class DefaultAccessTokenAuthenticator : IAuthenticationProvider
    {
        /// &lt;summary&gt;
        /// No pre-auth step required for this type of authentication
        /// &lt;/summary&gt;
        public bool IsPreAuthRequired { get { return false; } }

#pragma warning disable 0067
        /// &lt;summary&gt;
        /// Not used event as IsPreAuthRequired is false
        /// &lt;/summary&gt;
        public event OnAuthenticationSuccededDelegate OnAuthenticationSucceded;

        /// &lt;summary&gt;
        /// Not used event as IsPreAuthRequired is false
        /// &lt;/summary&gt;
        public event OnAuthenticationFailedDelegate OnAuthenticationFailed;

#pragma warning restore 0067

        private HubConnection _connection;

        public DefaultAccessTokenAuthenticator(HubConnection connection)
        {
            this._connection = connection;
        }

        /// &lt;summary&gt;
        /// Not used as IsPreAuthRequired is false
        /// &lt;/summary&gt;
        public void StartAuthentication()
        { }

        /// &lt;summary&gt;
        /// Prepares the request by adding two headers to it
        /// &lt;/summary&gt;
        public void PrepareRequest(BestHTTP.HTTPRequest request)
        {
            if (this._connection.NegotiationResult == null)
                return;

            // Add Authorization header to http requests, add access_token param to the uri otherwise
            if (BestHTTP.Connections.HTTPProtocolFactory.GetProtocolFromUri(request.CurrentUri) == BestHTTP.Connections.SupportedProtocols.HTTP)
                request.SetHeader(&quot;Authorization&quot;, &quot;Bearer &quot; + this._connection.NegotiationResult.AccessToken);
            else
#if !BESTHTTP_DISABLE_WEBSOCKET
                if (BestHTTP.Connections.HTTPProtocolFactory.GetProtocolFromUri(request.Uri) != BestHTTP.Connections.SupportedProtocols.WebSocket)
                    request.Uri = PrepareUriImpl(request.Uri);
#else
                ;
#endif
        }

        public Uri PrepareUri(Uri uri)
        {
            if (this._connection.NegotiationResult == null)
                return uri;

            if (uri.Query.StartsWith(&quot;??&quot;))
            {
                UriBuilder builder = new UriBuilder(uri);
                builder.Query = builder.Query.Substring(2);

                return builder.Uri;
            }

#if !BESTHTTP_DISABLE_WEBSOCKET
            if (BestHTTP.Connections.HTTPProtocolFactory.GetProtocolFromUri(uri) == BestHTTP.Connections.SupportedProtocols.WebSocket)
                uri = PrepareUriImpl(uri);
#endif

            return uri;

        }

        private Uri PrepareUriImpl(Uri uri)
        {
            string query = string.IsNullOrEmpty(uri.Query) ? &quot;&quot; : uri.Query + &quot;&amp;&quot;;
            UriBuilder uriBuilder = new UriBuilder(uri.Scheme, uri.Host, uri.Port, uri.AbsolutePath, query + &quot;access_token=&quot; + this._connection.NegotiationResult.AccessToken);
            return uriBuilder.Uri;
        }

        public void Cancel()
        { }
    }
}
</code></pre>

<h1 id="using-an-iauthenticationprovider-implementation">Using an IAuthenticationProvider implementation</h1>
<p>An <code>IAuthenticationProvider</code> implementation can be used through the <code>HubConnection</code>'s <code>AuthenticationProvider</code>:</p>
<pre><code class="language-csharp">hub = new HubConnection(new Uri(&quot;https://server/hub&quot;), new JsonProtocol(new LitJsonEncoder()));
hub.AuthenticationProvider = new BestHTTP.SignalRCore.Authentication.DefaultAccessTokenAuthenticator(hub);
</code></pre>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../3.Encoders/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../3.Encoders/" class="btn btn-xs btn-link">
        Encoders
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../1.HubConnection/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../1.HubConnection/" class="btn btn-xs btn-link">
        The HubConnection Class
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>