<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Tivadar György Nagy">
    <link rel="canonical" href="http://u3d.as/5sb/1.HTTP/AdvancedTopics/Caching/">
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Caching - Best HTTP/2 Documentation</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
	<link rel="stylesheet" href="../../../css/prism.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
	<script src="../../../js/prism.js"></script>
	
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Headers", url: "#_top", children: [
          ]},
          {title: "Disable caching", url: "#disable-caching", children: [
          ]},
          {title: "Caching related properties", url: "#caching-related-properties", children: [
          ]},
          {title: "Maintainence", url: "#maintainence", children: [
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script> 
</head>

<body class="line-numbers match-braces" >
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Cookies/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Cookies/" class="btn btn-xs btn-link">
        Cookies
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Authentication/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Authentication/" class="btn btn-xs btn-link">
        Authentication
      </a>
    </div>
    
  </div>

    

    <p>Caching works automatically and without any further setup. The plugin handles the caching headers received from the server in the response and adds additional headers to the request to check the cached content's freshness. </p>
<h2 id="headers">Headers</h2>
<p>Caching uses the following headers:</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/ETag">ETag</a>: When present for a cached entity, the plugin will send out an <code>If-None-Match</code> header with the following request to test the stored entity's freshness. If the server returns with an <em>304 - Not Modified</em>, the plugin loads the content from the local cache.</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Last-Modified">Last-Modified</a>: All operations is the same as with the ETag header, but it will send out an <code>If-Modified-Since</code> header.</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Expires">Expires</a>: When present for a cached entity and its value is in the future, the plugin loads content from the cache without contacting the server to validate the entity's freshness. When present all previous headers are ignored.</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control">Cache-Control</a>: When present with the max-age option and the entity's calculated age is less then its max-age, the plugin loads the content from the cache the same way as with the Expires. When present all previous headers are ignored.</li>
</ul>
<p>Flow-chart about caching:</p>
<p><img alt="Caching Explained" src="../media/CachingExplained.svg" /></p>
<h2 id="disable-caching">Disable caching</h2>
<p>There's quite a few ways to disable caching. It can be done globally with the <a href="../../../7.GlobalTopics/HowToDisableFeatures/">BESTHTTP_DISABLE_CACHING</a> define or by setting <a href="../../../7.GlobalTopics/GlobalSettings/">HTTPManager.IsCachingDisabled</a> to true before any HTTPRequest instantiation:</p>
<pre><code class="language-csharp">HTTPManager.IsCachingDisabled = true;
</code></pre>

<p>It can be disabled per-request by setting the HTTPRequest's DisableCache property to true:</p>
<pre><code class="language-csharp">var request = new HTTPRequest(new Uri(&quot;...&quot;), ImageDownloaded);
request.DisableCache = true;
request.Send();
</code></pre>

<h2 id="caching-related-properties">Caching related properties</h2>
<p><u>HTTPRequest</u>:</p>
<ul>
<li><strong>DisableCache</strong>: With this property caching can be enabled/disabled on a per-request basis.</li>
<li><strong>CacheOnly</strong>: It can be used with <a href="../DownloadStreaming/">streaming</a>. When set to true, no <code>OnStreamingData</code> event is called, the streamed content will be saved straight to the cache if all requirements are met(caching is enabled and there's a caching headers).</li>
</ul>
<p><u>HTTPResponse</u>:</p>
<ul>
<li><strong>IsFromCache</strong>: Indicates that the response body is read from the cache.</li>
<li><strong>CacheFileInfo</strong>: Provides information about the file used for caching the request.</li>
<li><strong>IsCacheOnly</strong>: Determines if this response is only stored to cache. If both <code>IsCacheOnly</code> and <code>IsStreamed</code> are true, <code>OnStreamingData</code> isn't called.</li>
</ul>
<h2 id="maintainence">Maintainence</h2>
<p>Although caching is automatic we have some control over it, or we can gain some info using the public functions of the <code>HTTPCacheService</code> class:</p>
<ul>
<li><strong>BeginClear()</strong>: It will start clearing the entire cache on a separate thread.</li>
<li><strong>BeginMaintainence()</strong>: With this function’s help, we can delete cached entries based on the last access time. It deletes entries that’s last access time is older than the specified time. We can also use this function to keep the cache size under control:</li>
</ul>
<pre><code class="language-csharp">// Delete cache entries that weren’t accessed in the last two weeks, then
// delete entries to keep the size of the cache under 50 megabytes, starting with the oldest.
HTTPCacheService.BeginMaintainence(new HTTPCacheMaintananceParams(TimeSpan.FromDays(14), 50 * 1024 * 1024));
</code></pre>

<ul>
<li><strong>GetCacheSize()</strong>: Will return the size of the cache in bytes.</li>
<li>
<p><strong>GetCacheEntryCount()</strong>: Will return the number of the entries stored in the cache. The average cache entry size can be computed with the <code>float avgSize = GetCacheSize() / (float) GetCacheEntryCount()</code> formula.</p>
</li>
<li>
<p><strong>IsDoingMaintainence</strong>: Its value is <code>true</code> while the cache service doing any Clear or Maintainence on a separate thread.</p>
</li>
</ul>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Cookies/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Cookies/" class="btn btn-xs btn-link">
        Cookies
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Authentication/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Authentication/" class="btn btn-xs btn-link">
        Authentication
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>