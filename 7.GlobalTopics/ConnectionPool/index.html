<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Tivadar György Nagy">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Connection Pooling - Best HTTP/2 Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Connection Pooling";
    var mkdocs_page_input_path = "7.GlobalTopics\\ConnectionPool.md";
    var mkdocs_page_url = "/5sb/7.GlobalTopics/ConnectionPool/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Best HTTP/2 Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Introduction</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../ThirdPartyNotices/">Third-Party Notices</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../UpgradeGuide/">UpgradeGuide</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../changelog/">Changelog</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../platforms/">Platforms</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">1.HTTP</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../1.HTTP/GettingStarted/">Getting Started Quickly</a>
                </li>
                <li class="">
                    
    <a class="" href="../../1.HTTP/HTTPRequest/">HTTPRequest</a>
                </li>
                <li class="">
                    
    <a class="" href="../../1.HTTP/HTTPResponse/">HTTPResponse</a>
                </li>
                <li class="">
                    
    <span class="caption-text">AdvancedTopics</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../1.HTTP/AdvancedTopics/Async-await/">Async-Await with HTTPRequest</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../1.HTTP/AdvancedTopics/Authentication/">Authentication</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../1.HTTP/AdvancedTopics/Caching/">Caching</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../1.HTTP/AdvancedTopics/Cookies/">Cookies</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../1.HTTP/AdvancedTopics/DownloadProgress/">Download Progress Tracking</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../1.HTTP/AdvancedTopics/DownloadStreaming/">Download Streaming</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../1.HTTP/AdvancedTopics/ErrorHandling/">ErrorHandling</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../1.HTTP/AdvancedTopics/Redirections/">Control Redirections</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../1.HTTP/AdvancedTopics/Request.Abort/">Aborting a Request</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../1.HTTP/AdvancedTopics/RequestStates/">Request States</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../1.HTTP/AdvancedTopics/ServerCertificateValidation/">Server Certificate Validation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../1.HTTP/AdvancedTopics/SmallCode-Samples/">Small Code-Samples</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../1.HTTP/AdvancedTopics/Timeouts/">Timeouts</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../1.HTTP/AdvancedTopics/Timing/">Timing API</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../1.HTTP/AdvancedTopics/UploadProgress/">Upload Progress Tracking</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../1.HTTP/AdvancedTopics/UploadStreaming/">Upload Streaming</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">2.WebSocket</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../2.WebSocket/">Index</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">3.1Socket.IO3</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../3.1Socket.IO3/">Socket.IO 3</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">3.Socket.IO</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../3.Socket.IO/">SocketIO</a>
                </li>
                <li class="">
                    
    <a class="" href="../../3.Socket.IO/1.Namespaces/">Connecting to namespaces</a>
                </li>
                <li class="">
                    
    <a class="" href="../../3.Socket.IO/2.ReceivingEvents/">Subscribing and receiving events</a>
                </li>
                <li class="">
                    
    <a class="" href="../../3.Socket.IO/3.SendingEvents/">Sending events</a>
                </li>
                <li class="">
                    
    <a class="" href="../../3.Socket.IO/4.DefaultEncoder/">Set the default Json encoder</a>
                </li>
                <li class="">
                    
    <a class="" href="../../3.Socket.IO/5.CustomEncoder/">Writing a custom Json encoder</a>
                </li>
                <li class="">
                    
    <a class="" href="../../3.Socket.IO/6.AutoDecodePayload/">AutoDecodePayload</a>
                </li>
                <li class="">
                    
    <a class="" href="../../3.Socket.IO/7.ErrorHandling/">Error handling</a>
                </li>
                <li class="">
                    
    <a class="" href="../../3.Socket.IO/8.Options/">The SocketOptions class</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">4.SignalR</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../4.SignalR/">Index</a>
                </li>
                <li class="">
                    
    <a class="" href="../../4.SignalR/1.Connection/">The Connection class</a>
                </li>
                <li class="">
                    
    <a class="" href="../../4.SignalR/2.GeneralEvents/">Handling general events</a>
                </li>
                <li class="">
                    
    <a class="" href="../../4.SignalR/3.Sending/">Sending non-Hub messages</a>
                </li>
                <li class="">
                    
    <a class="" href="../../4.SignalR/4.Hubs/">Hubs</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">5.EventSource</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../5.EventSource/">Server-Sent Events (EventSource)</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">6.SignalRCore</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../6.SignalRCore/">SignalR Core</a>
                </li>
                <li class="">
                    
    <a class="" href="../../6.SignalRCore/1.HubConnection/">The HubConnection Class</a>
                </li>
                <li class="">
                    
    <a class="" href="../../6.SignalRCore/2.Authentication/">The IAuthenticationProvider interface</a>
                </li>
                <li class="">
                    
    <a class="" href="../../6.SignalRCore/3.Encoders/">Encoders</a>
                </li>
                <li class="">
                    
    <a class="" href="../../6.SignalRCore/4.IRetryPolicy/">Automatic reconnection and the IRetryPolicy interface</a>
                </li>
                <li class="">
                    
    <a class="" href="../../6.SignalRCore/5.AzureSignalRService/">How to connect to an Azure SignalR Service</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">7.GlobalTopics</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../BufferPool/">Buffer Pool</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Connection Pooling</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#connection-pooling">Connection Pooling</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../GlobalSettings/">Global Settings</a>
                </li>
                <li class="">
                    
    <a class="" href="../HTTP2/">HTTP/2</a>
                </li>
                <li class="">
                    
    <a class="" href="../HTTPS/">HTTPS</a>
                </li>
                <li class="">
                    
    <a class="" href="../HowToDisableFeatures/">How to disable features</a>
                </li>
                <li class="">
                    
    <a class="" href="../Logging/">Logging</a>
                </li>
                <li class="">
                    
    <a class="" href="../Proxy/">Proxies</a>
                </li>
                <li class="">
                    
    <a class="" href="../ThreadSafety/">ThreadSafety</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">8.Addons</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">TLSSecurity</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../8.Addons/TLSSecurity/">About</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../8.Addons/TLSSecurity/CertificationManagerWindow/">CertificationManagerWindow</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../8.Addons/TLSSecurity/Options/">SecurityOptions</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">cURLParser</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../8.Addons/cURLParser/">Index</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Best HTTP/2 Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>7.GlobalTopics &raquo;</li>
        
      
    
    <li>Connection Pooling</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="connection-pooling">Connection Pooling</h1>
<p>This topic applies to connections for HTTP/1.1 requests only. HTTP/2 has proper messaging to communicate state changes between the client and server.</p>
<p>Building up a TCP connection and negotiating TLS for HTTPS are slow that we can avoid if we reuse the connections for future requests. The plugin informs the server that it want to keep the connection alive for future use by sending a "<em>Connection: Keep-Alive</em>" header. 
While the server could inform the client <a href="https://tools.ietf.org/html/draft-thomson-hybi-http-timeout-03">by sending back a <em>Keep-Alive</em> header</a> about how much time it’s going to wait for a new request before get bored and closing the connection, 
servers are rarely use and send this <em>Keep-Alive</em> header. So, both the server and clients are blind to each other's setting and there’s no other way other than the keep-alive header to let the other side know when the connection is going to be closed.</p>
<p>In a case where the server closes an idle connection after 5 seconds and the client goes with its default 20 seconds, the client going to try to (re)use the connection way behind 5 seconds, resulting in a failed request. </p>
<p>One option to fix it to set either the server’s or the client’s setting to the same as the other. 
Another one is to disable connection reuse completely (set HTTPManager.KeepAliveDefaultValue to false). While this is the safest way, and in some cases can be beneficial (for example when you know that you going to send out requests sparingly, outside of the idle time), 
it’s better to try to keep the server and client setting in sync to reuse a TCP connection as much as possible.</p>
<p>So, it worked because with the new setting, both the client and server closed the connection about the same time. Setting the client to the same value still can result in failed connections however, because the server starts to count down when it finished writing the response to the wire, 
and the client starts to count down when it finished receiving it. With a slow network (== high network latency), this can be large enough to increase the chance that the client is trying to use a server-closed connection. 
If you want to use connection pooling but want a safer value, I would recommend to set the client’s setting one seconds lower than the server has.</p>
<p>To set the idle time for the client the <code>MaxConnectionIdleTime</code> property can be used:</p>
<pre><code class="language-csharp">HTTPManager.MaxConnectionIdleTime = TimeSpan.FromSeconds(4);
</code></pre>

<p>Disable connection pooling:</p>
<pre><code class="language-csharp">HTTPManager.KeepAliveDefaultValue = false;
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../GlobalSettings/" class="btn btn-neutral float-right" title="Global Settings">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../BufferPool/" class="btn btn-neutral" title="Buffer Pool"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../BufferPool/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../GlobalSettings/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>

</body>
</html>
