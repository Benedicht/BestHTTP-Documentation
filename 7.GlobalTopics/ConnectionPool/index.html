<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Tivadar György Nagy">
    <link rel="canonical" href="http://u3d.as/5sb/7.GlobalTopics/ConnectionPool/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Connection Pooling - Best HTTP/2 Documentation</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
	<link rel="stylesheet" href="../../css/prism.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
	<script src="../../js/prism.js"></script>
	
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Connection Pooling", url: "#_top", children: [
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body class="line-numbers match-braces" >
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../GlobalSettings/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../GlobalSettings/" class="btn btn-xs btn-link">
        Global Settings
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../BufferPool/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../BufferPool/" class="btn btn-xs btn-link">
        Buffer Pool
      </a>
    </div>
    
  </div>

    

    <h1 id="connection-pooling">Connection Pooling</h1>
<p>This topic applies to connections for HTTP/1.1 requests only. HTTP/2 has proper messaging to communicate state changes between the client and server.</p>
<p>Building up a TCP connection and negotiating TLS for HTTPS are slow that we can avoid if we reuse the connections for future requests. The plugin informs the server that it want to keep the connection alive for future use by sending a "<em>Connection: Keep-Alive</em>" header. 
While the server could inform the client <a href="https://tools.ietf.org/html/draft-thomson-hybi-http-timeout-03">by sending back a <em>Keep-Alive</em> header</a> about how much time it’s going to wait for a new request before get bored and closing the connection, 
servers are rarely use and send this <em>Keep-Alive</em> header. So, both the server and clients are blind to each other's setting and there’s no other way other than the keep-alive header to let the other side know when the connection is going to be closed.</p>
<p>In a case where the server closes an idle connection after 5 seconds and the client goes with its default 20 seconds, the client going to try to (re)use the connection way behind 5 seconds, resulting in a failed request. </p>
<p>One option to fix it to set either the server’s or the client’s setting to the same as the other. 
Another one is to disable connection reuse completely (set HTTPManager.KeepAliveDefaultValue to false). While this is the safest way, and in some cases can be beneficial (for example when you know that you going to send out requests sparingly, outside of the idle time), 
it’s better to try to keep the server and client setting in sync to reuse a TCP connection as much as possible.</p>
<p>So, it worked because with the new setting, both the client and server closed the connection about the same time. Setting the client to the same value still can result in failed connections however, because the server starts to count down when it finished writing the response to the wire, 
and the client starts to count down when it finished receiving it. With a slow network (== high network latency), this can be large enough to increase the chance that the client is trying to use a server-closed connection. 
If you want to use connection pooling but want a safer value, I would recommend to set the client’s setting one seconds lower than the server has.</p>
<p>To set the idle time for the client the <code>MaxConnectionIdleTime</code> property can be used:</p>
<pre><code class="language-csharp">HTTPManager.MaxConnectionIdleTime = TimeSpan.FromSeconds(4);
</code></pre>

<p>Disable connection pooling:</p>
<pre><code class="language-csharp">HTTPManager.KeepAliveDefaultValue = false;
</code></pre>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../GlobalSettings/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../GlobalSettings/" class="btn btn-xs btn-link">
        Global Settings
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../BufferPool/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../BufferPool/" class="btn btn-xs btn-link">
        Buffer Pool
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>