<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Tivadar GyÃ¶rgy Nagy">
    <link rel="canonical" href="http://u3d.as/5sb/7.GlobalTopics/BufferPool/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Buffer Pool - Best HTTP/2 Documentation</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
	<link rel="stylesheet" href="../../css/prism.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
	<script src="../../js/prism.js"></script>
	
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Buffer Pool", url: "#_top", children: [
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body class="line-numbers match-braces" >
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../ConnectionPool/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../ConnectionPool/" class="btn btn-xs btn-link">
        Connection Pooling
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../6.SignalRCore/5.AzureSignalRService/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../6.SignalRCore/5.AzureSignalRService/" class="btn btn-xs btn-link">
        How to connect to an Azure SignalR Service
      </a>
    </div>
    
  </div>

    

    <h1 id="buffer-pool">Buffer Pool</h1>
<p>To reduce memory garbage production the plugin reuses as much memory as it can. To support this, the plugin implements and uses a byte array pooling mechanism through the <code>BufferPool</code> static class. The plugin uses this class to allocate and release <code>byte[]</code>s back to the pool. </p>
<p>To avoid keeping reference to too much memory the plugin requests buffers with a minimum size. This way if the <code>BufferPool</code> has no buffer for the requested size, it can return a larger buffer. Also, buffers stored in the pool can time out, releasing back to the runtime for garbage collection.</p>
<p>Pooling mechanism can be disabled, configured and used by outside of the plugin. Configurable fields are the following:</p>
<ul>
<li><strong>IsEnabled</strong>: Setting this field to false the pooling mechanism can be disabled. Its default value is <code>true</code>.</li>
<li><strong>RemoveOlderThan</strong>: Buffer entries that released back to the pool and older than this value are removed from the pool (so the GC can collect them) when next maintenance is triggered. Its default value is 30 seconds.</li>
<li><strong>RunMaintenanceEvery</strong>: How often pool maintenance must run. Its default value is 10 seconds.</li>
<li><strong>MinBufferSize</strong>: Minimum buffer size that the plugin will allocate when the requested size is smaller than this value, and canBeLarger is set to true. Its default value 256 bytes.</li>
<li><strong>MaxBufferSize</strong>: Maximum size of a buffer that the plugin will store. Its default value is <code>long.MaxValue</code>.</li>
<li><strong>MaxPoolSize</strong>: Maximum accumulated size of the stored buffers. Its default value is 10 Mb.</li>
<li><strong>RemoveEmptyLists</strong>: Whether to remove empty buffer stores from the free list. Its default value is <code>true</code>.</li>
<li><strong>IsDoubleReleaseCheckEnabled</strong>: If it set to true and a byte[] is released more than once it will log out an error. Its default value is <code>true</code> when run in the editor, <code>false</code> otherwise.</li>
</ul>
<p>So to disable pooling the following line can be added:</p>
<pre><code class="language-csharp">BestHTTP.PlatformSupport.Memory.BufferPool.IsEnabled = false;
</code></pre>

<p>The following functions are available to use the pool:</p>
<ul>
<li><strong>byte[] Get(long size, bool canBeLarger)</strong>: Get a byte array from the pool. If <code>canBeLarge</code> is <code>true</code>, the returned buffer might be larger than the requested size.</li>
<li><strong>void Release(byte[] buffer)</strong>: Release back a byte array to the pool.</li>
<li><strong>byte[] Resize(ref byte[] buffer, int newSize, bool canBeLarger)</strong>: Resize a byte array. It will release the old one to the pool and get a new one from the pool.</li>
<li><strong>void Clear()</strong>: Remove all stored entries instantly.</li>
</ul>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../ConnectionPool/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../ConnectionPool/" class="btn btn-xs btn-link">
        Connection Pooling
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../6.SignalRCore/5.AzureSignalRService/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../6.SignalRCore/5.AzureSignalRService/" class="btn btn-xs btn-link">
        How to connect to an Azure SignalR Service
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>