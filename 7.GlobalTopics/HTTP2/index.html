<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Tivadar GyÃ¶rgy Nagy">
    <link rel="canonical" href="http://u3d.as/5sb/7.GlobalTopics/HTTP2/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>HTTP/2 - Best HTTP/2 Documentation</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
	<link rel="stylesheet" href="../../css/prism.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
	<script src="../../js/prism.js"></script>
	
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "HTTP/2", url: "#_top", children: [
              {title: "How it works", url: "#how-it-works" },
          ]},
          {title: "Settings", url: "#settings", children: [
              {title: "MaxConcurrentStreams", url: "#maxconcurrentstreams" },
              {title: "InitialStreamWindowSize", url: "#initialstreamwindowsize" },
              {title: "InitialConnectionWindowSize", url: "#initialconnectionwindowsize" },
              {title: "MaxFrameSize", url: "#maxframesize" },
              {title: "MaxIdleTime", url: "#maxidletime" },
          ]},
          {title: "WebSocket Over HTTP/2 Settings", url: "#websocket-over-http2-settings", children: [
              {title: "EnableWebSocketOverHTTP2", url: "#enablewebsocketoverhttp2" },
              {title: "EnableImplementationFallback", url: "#enableimplementationfallback" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body class="line-numbers match-braces" >
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../HTTPS/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../HTTPS/" class="btn btn-xs btn-link">
        HTTPS
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../GlobalSettings/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../GlobalSettings/" class="btn btn-xs btn-link">
        Global Settings
      </a>
    </div>
    
  </div>

    

    <h1 id="http2">HTTP/2</h1>
<h2 id="how-it-works">How it works</h2>
<p>BestHTTP implements HTTP/2 over TLS. Using the TLS negotiation and its ALPN extension the plugin let the server know that it's ready to upgrade to the HTTP/2 protocol. 
If the server has support for HTTP/2 and sends back the proper answer the plugin upgrades the connection and will communicate with the server using the HTTP/2 protocol. Using the TLS' ALPN extension upgrading to HTTP/2 is faster.</p>
<p>However, when multiple requests are made to the same server and the plugin don't know whether the server capable to upgrade to HTTP/2, it will create only one connection to test against http/2. If the server reports no HTTP/2/2 support, the plugin will open new connections depending on the value of <code>HTTPManager.MaxConnectionPerServer</code>. if the server supports HTTP/2, the plugin will use that connection only.
This mechanism prevents the plugin to open multiple connections that will be used only for one request. The plugin also stores what servers are supporting HTTP/2, so next time it can decide whether it should open multiple connections or not.</p>
<p>Using HTTP/2 is seemless and requires no prior knowledge whether any target servers has support for it or not. The plugin hides differencies HTTP1.1 and HTTP/2 from the user, but will take advantage of the new protocol every time it has a chance.</p>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>With HTTP/2 the <code>HTTPRequest</code>'s <code>IsKeepAlive</code> setting is ignored.</p>
</div>
<h1 id="settings">Settings</h1>
<p>As most of the global settings, HTTP/2 settings can be accessed through the <code>HTTPManager</code> class:</p>
<pre><code class="language-csharp">using BestHTTP;

HTTPManager.HTTP2Settings.InitialStreamWindowSize = 5 * 1024 * 1024;
</code></pre>

<h2 id="maxconcurrentstreams">MaxConcurrentStreams</h2>
<p>Maximum concurrent http2 stream on http2 connection will allow. Its default value is 128;</p>
<pre><code class="language-csharp">HTTPManager.HTTP2Settings.MaxConcurrentStreams = 256;
</code></pre>

<h2 id="initialstreamwindowsize">InitialStreamWindowSize</h2>
<p>Initial window size of a http2 stream. Its default value is 10 MiB (10 * 1024 * 1024).</p>
<pre><code class="language-csharp">HTTPManager.HTTP2Settings.InitialStreamWindowSize = 1 * 1024 * 1024;
</code></pre>

<h2 id="initialconnectionwindowsize">InitialConnectionWindowSize</h2>
<p>Global window size of a http/2 connection. Its default value is the maximum possible value on 31 bits.</p>
<pre><code class="language-csharp">HTTPManager.HTTP2Settings.InitialConnectionWindowSize = HTTPManager.HTTP2Settings.MaxConcurrentStreams * 1024 * 1024;
</code></pre>

<h2 id="maxframesize">MaxFrameSize</h2>
<p>Maximum payload size of a http2 frame. Its default value is 16384. It must be between 16_384 and 16_777_215.</p>
<pre><code class="language-csharp">HTTPManager.HTTP2Settings.MaxFrameSize = 1 * 1024 * 1024;
</code></pre>

<h2 id="maxidletime">MaxIdleTime</h2>
<p>With HTTP/2 only one connection will be open so we can can keep it open longer as we hope it will be resued more. Its default value is 120 seconds.</p>
<pre><code class="language-csharp">HTTPManager.HTTP2Settings.MaxIdleTime = TimeSpan.FromSeconds(30);
</code></pre>

<h1 id="websocket-over-http2-settings">WebSocket Over HTTP/2 Settings</h1>
<p>Through these options the WebSocket Over HTTP/2 implementation can be customized.</p>
<h2 id="enablewebsocketoverhttp2">EnableWebSocketOverHTTP2</h2>
<p>Set it to false to disable Websocket Over HTTP/2 (RFC 8441). It's true by default.</p>
<pre><code class="language-csharp">HTTPManager.HTTP2Settings.WebSocketOverHTTP2Settings.EnableWebSocketOverHTTP2 = false;
</code></pre>

<h2 id="enableimplementationfallback">EnableImplementationFallback</h2>
<p>Set it to disable fallback logic from the Websocket Over HTTP/2 implementation to the 'old' HTTP/1 implementation when it fails to connect.</p>
<pre><code class="language-csharp">HTTPManager.HTTP2Settings.WebSocketOverHTTP2Settings.EnableImplementationFallback = false;
</code></pre>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../HTTPS/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../HTTPS/" class="btn btn-xs btn-link">
        HTTPS
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../GlobalSettings/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../GlobalSettings/" class="btn btn-xs btn-link">
        Global Settings
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>