<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Tivadar György Nagy">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Socket.IO 3 - Best HTTP/2 Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Socket.IO 3";
    var mkdocs_page_input_path = "3.1Socket.IO3\\index.md";
    var mkdocs_page_url = "/5sb/3.1Socket.IO3/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Best HTTP/2 Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Introduction</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../ThirdPartyNotices/">Third-Party Notices</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../UpgradeGuide/">UpgradeGuide</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../changelog/">Changelog</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../platforms/">Platforms</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">1.HTTP</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../1.HTTP/GettingStarted/">Getting Started Quickly</a>
                </li>
                <li class="">
                    
    <a class="" href="../1.HTTP/HTTPRequest/">HTTPRequest</a>
                </li>
                <li class="">
                    
    <a class="" href="../1.HTTP/HTTPResponse/">HTTPResponse</a>
                </li>
                <li class="">
                    
    <span class="caption-text">AdvancedTopics</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../1.HTTP/AdvancedTopics/Async-await/">Async-Await with HTTPRequest</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../1.HTTP/AdvancedTopics/Authentication/">Authentication</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../1.HTTP/AdvancedTopics/Caching/">Caching</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../1.HTTP/AdvancedTopics/Cookies/">Cookies</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../1.HTTP/AdvancedTopics/DownloadProgress/">Download Progress Tracking</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../1.HTTP/AdvancedTopics/DownloadStreaming/">Download Streaming</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../1.HTTP/AdvancedTopics/ErrorHandling/">ErrorHandling</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../1.HTTP/AdvancedTopics/Redirections/">Control Redirections</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../1.HTTP/AdvancedTopics/Request.Abort/">Aborting a Request</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../1.HTTP/AdvancedTopics/RequestStates/">Request States</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../1.HTTP/AdvancedTopics/ServerCertificateValidation/">Server Certificate Validation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../1.HTTP/AdvancedTopics/SmallCode-Samples/">Small Code-Samples</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../1.HTTP/AdvancedTopics/Timeouts/">Timeouts</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../1.HTTP/AdvancedTopics/Timing/">Timing API</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../1.HTTP/AdvancedTopics/UploadProgress/">Upload Progress Tracking</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../1.HTTP/AdvancedTopics/UploadStreaming/">Upload Streaming</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">2.WebSocket</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../2.WebSocket/">Index</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">3.1Socket.IO3</span>
    <ul class="subnav">
                <li class=" current">
                    
    <a class="current" href="./">Socket.IO 3</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#socketio-3">Socket.IO 3</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#connecting-to-a-socketio-service">Connecting to a Socket.IO service</a></li>
        
            <li><a class="toctree-l4" href="#socket-ids">Socket IDs</a></li>
        
            <li><a class="toctree-l4" href="#disconnecting">Disconnecting</a></li>
        
            <li><a class="toctree-l4" href="#subscribing-to-events">Subscribing to events</a></li>
        
            <li><a class="toctree-l4" href="#sending-events">Sending Events</a></li>
        
            <li><a class="toctree-l4" href="#namespaces">Namespaces</a></li>
        
            <li><a class="toctree-l4" href="#rooms">Rooms</a></li>
        
            <li><a class="toctree-l4" href="#options">Options</a></li>
        
            <li><a class="toctree-l4" href="#reconnection">Reconnection</a></li>
        
            <li><a class="toctree-l4" href="#emitted-events">Emitted events</a></li>
        
            <li><a class="toctree-l4" href="#parsers">Parsers</a></li>
        
        </ul>
    

    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">3.Socket.IO</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../3.Socket.IO/">SocketIO</a>
                </li>
                <li class="">
                    
    <a class="" href="../3.Socket.IO/1.Namespaces/">Connecting to namespaces</a>
                </li>
                <li class="">
                    
    <a class="" href="../3.Socket.IO/2.ReceivingEvents/">Subscribing and receiving events</a>
                </li>
                <li class="">
                    
    <a class="" href="../3.Socket.IO/3.SendingEvents/">Sending events</a>
                </li>
                <li class="">
                    
    <a class="" href="../3.Socket.IO/4.DefaultEncoder/">Set the default Json encoder</a>
                </li>
                <li class="">
                    
    <a class="" href="../3.Socket.IO/5.CustomEncoder/">Writing a custom Json encoder</a>
                </li>
                <li class="">
                    
    <a class="" href="../3.Socket.IO/6.AutoDecodePayload/">AutoDecodePayload</a>
                </li>
                <li class="">
                    
    <a class="" href="../3.Socket.IO/7.ErrorHandling/">Error handling</a>
                </li>
                <li class="">
                    
    <a class="" href="../3.Socket.IO/8.Options/">The SocketOptions class</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">4.SignalR</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../4.SignalR/">Index</a>
                </li>
                <li class="">
                    
    <a class="" href="../4.SignalR/1.Connection/">The Connection class</a>
                </li>
                <li class="">
                    
    <a class="" href="../4.SignalR/2.GeneralEvents/">Handling general events</a>
                </li>
                <li class="">
                    
    <a class="" href="../4.SignalR/3.Sending/">Sending non-Hub messages</a>
                </li>
                <li class="">
                    
    <a class="" href="../4.SignalR/4.Hubs/">Hubs</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">5.EventSource</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../5.EventSource/">Server-Sent Events (EventSource)</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">6.SignalRCore</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../6.SignalRCore/">SignalR Core</a>
                </li>
                <li class="">
                    
    <a class="" href="../6.SignalRCore/1.HubConnection/">The HubConnection Class</a>
                </li>
                <li class="">
                    
    <a class="" href="../6.SignalRCore/2.Authentication/">The IAuthenticationProvider interface</a>
                </li>
                <li class="">
                    
    <a class="" href="../6.SignalRCore/3.Encoders/">Encoders</a>
                </li>
                <li class="">
                    
    <a class="" href="../6.SignalRCore/4.IRetryPolicy/">Automatic reconnection and the IRetryPolicy interface</a>
                </li>
                <li class="">
                    
    <a class="" href="../6.SignalRCore/5.AzureSignalRService/">How to connect to an Azure SignalR Service</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">7.GlobalTopics</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../7.GlobalTopics/BufferPool/">Buffer Pool</a>
                </li>
                <li class="">
                    
    <a class="" href="../7.GlobalTopics/ConnectionPool/">Connection Pooling</a>
                </li>
                <li class="">
                    
    <a class="" href="../7.GlobalTopics/GlobalSettings/">Global Settings</a>
                </li>
                <li class="">
                    
    <a class="" href="../7.GlobalTopics/HTTP2/">HTTP/2</a>
                </li>
                <li class="">
                    
    <a class="" href="../7.GlobalTopics/HTTPS/">HTTPS</a>
                </li>
                <li class="">
                    
    <a class="" href="../7.GlobalTopics/HowToDisableFeatures/">How to disable features</a>
                </li>
                <li class="">
                    
    <a class="" href="../7.GlobalTopics/Logging/">Logging</a>
                </li>
                <li class="">
                    
    <a class="" href="../7.GlobalTopics/Proxy/">Proxies</a>
                </li>
                <li class="">
                    
    <a class="" href="../7.GlobalTopics/ThreadSafety/">ThreadSafety</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">8.Addons</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">TLSSecurity</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../8.Addons/TLSSecurity/">About</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../8.Addons/TLSSecurity/CertificationManagerWindow/">CertificationManagerWindow</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../8.Addons/TLSSecurity/Options/">SecurityOptions</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">cURLParser</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../8.Addons/cURLParser/">Index</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Best HTTP/2 Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>3.1Socket.IO3 &raquo;</li>
        
      
    
    <li>Socket.IO 3</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="socketio-3">Socket.IO 3</h1>
<p>Changes made in Socket.IO v3 (and Engine.IO v4) enables a less complex parser and message sending logic. To make the plugin's Socket.IO implementation a more user-friendly API with strongly typed callbacks, keeping backward compatibility became unaccomplishable. Breaking the backward compatibility however enabled to add even more features like volatile emits and new parsers.</p>
<p>The old implementation is still available in the package, but with Socket.IO 3, i recommend to use classes from the new <em>BestHTTP.SocketIO3</em> namespace.</p>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>Compatible with Socket.IO 4 too as <a href="https://socket.io/docs/v4/migrating-from-3-x-to-4-0/">Socket.IO 4 contains no protocol related changes</a>.</p>
</div>
<h2 id="connecting-to-a-socketio-service">Connecting to a Socket.IO service</h2>
<p>First step to connect to a Socket.IO server is to create a SocketManager instance:</p>
<pre><code class="language-csharp">using BestHTTP.SocketIO3;

var manager = new SocketManager(new Uri(&quot;http://localhost:3000&quot;));
</code></pre>

<p>The official Socket.IO server implementation <a href="https://socket.io/docs/v3/server-initialization/#path">binds to the /socket.io/</a> path, and the client going to append it to the uri if the uri's path part isn't present.</p>
<p>By default SocketManager going to start to connect to the server as soon as a namespace is accessed through its <code>Socket</code> property or <code>GetSocket</code> function:</p>
<pre><code class="language-csharp">using BestHTTP.SocketIO3;

var manager = new SocketManager(new Uri(&quot;http://localhost:3000&quot;));

// Accessing the root (&quot;/&quot;) socket
var root = manager.Socket;

// or calling GetSocket triggers the connection procedure.
var customNamespace = manager.GetSocket(&quot;/my_namespace&quot;);

// At this point the manager already started to connect to the server
</code></pre>

<p>This auto connection can be disabled through a <code>SocketOptions</code> instance:</p>
<pre><code class="language-csharp">using BestHTTP.SocketIO3;

SocketOptions options = new SocketOptions();
options.AutoConnect = false;

var manager = new SocketManager(new Uri(&quot;http://localhost:3000&quot;), options);

var root = manager.Socket;
var customNamespace = manager.GetSocket(&quot;/my_namespace&quot;);

// AutoConnect is turned off, Open must be called
manager.Open();
</code></pre>

<p>This way the SocketManager going to start to connect to the server when its Open function is called.</p>
<p><code>Open</code> and connection to the server in general is non-blocking, the function returns immediately and messages are sent only after the <code>connect</code> event.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Don't forget that the new implementation is under the <code>BestHTTP.SocketIO3</code> namespace!</p>
</div>
<h2 id="socket-ids">Socket IDs</h2>
<p>As of Socket.IO 3 the connection has an ID and all namespaces (sockets) has a different one too. The connection's ID can be accessed through the <code>SocketManager</code>’s <code>Handshake</code> property:</p>
<pre><code class="language-csharp">var manager = new SocketManager(new Uri(&quot;http://localhost:3000&quot;));
manager.Socket.On(&quot;connect&quot;, () =&gt; Debug.Log(manager.Handshake.Sid));
</code></pre>

<p>Per-socket ID is received when the socket is connected, can be accessed through the connect event as a parameter, or later through the socket instance:</p>
<pre><code class="language-csharp">manager = new SocketManager(new Uri(&quot;http://localhost:3000&quot;), options);
manager.Socket.On&lt;ConnectResponse&gt;(SocketIOEventTypes.Connect, OnConnected);

void OnConnected(ConnectResponse resp)
{
    // Method 1: received as parameter
    Debug.Log(&quot;Sid through parameter: &quot; + resp.sid);

    // Method 2: access through the socket
    Debug.Log(&quot;Sid through socket: &quot; + manager.Socket.Id);
}
</code></pre>

<p><code>ConnectResponse</code>'s <code>sid</code> and <code>Socket</code>'s <code>Id</code> is the same value.</p>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p><code>ConnectResponse</code> can be found in the <em>BestHTTP.SocketIO3.Events</em> namespace.</p>
</div>
<h2 id="disconnecting">Disconnecting</h2>
<p><code>SocketManager</code>'s <code>Close</code> function closes all sockets, shuts down the transport and no more communication is done to the server. Calling <code>Disconnect</code> on a socket disconnects only that socket, communication through other sockets are still possible. Disconnecting the last socket closes the SocketManager too.</p>
<h2 id="subscribing-to-events">Subscribing to events</h2>
<p>Subscribing to Socket.IO events can be done through the <code>On</code> and <code>Once</code> functions. There's also an <code>ExpectAcknowledgement</code> function that can be used to define a callbacks that going to be called when <a href="https://socket.io/docs/v3/emitting-events/#Acknowledgements">the server executes a callback function</a>.</p>
<h3 id="parameterless-events">Parameterless events</h3>
<p>All functions to subscribe to events support parameterless events. These events aren't expects any parameters from the servers:</p>
<pre><code class="language-csharp">manager.Socket.On(&quot;connect&quot;, () =&gt; Debug.Log(&quot;connected!&quot;));
</code></pre>

<h3 id="strongly-typed-events">Strongly typed events</h3>
<p>Both <code>On</code> and <code>Once</code> can accept numerous type parameters and tries to parse the received event to match these types. For example the following call on the server:</p>
<pre><code class="language-csharp">socket.emit('message', 0, 1);
</code></pre>

<p>Thi event can be caught with the followin subscription on the client:</p>
<pre><code class="language-csharp">manager.Socket.On&lt;int, int&gt;(&quot;message&quot;, (arg1, arg2) =&gt; Debug.Log($&quot;{arg1}, {arg2}&quot;));
</code></pre>

<p>Here we subscribe to the event called <code>"message"</code>, expecting two <code>int</code> parameters.</p>
<p>Complex objects can be sent and subscribed to (Server):</p>
<pre><code class="language-csharp">socket.emit(&quot;user-info&quot;, {
    users: [&quot;User 1&quot;, &quot;User 2&quot;],
    buff: Buffer.from([9, 8, 7, 6, 5, 4, 3, 2, 1])
});
</code></pre>

<p>(Client:)</p>
<pre><code class="language-csharp">class UserInfo
{
    public string[] users;
    public byte[] buff;
}

manager.Socket.On&lt;UserInfo&gt;(&quot;user-info&quot;, OnUserInfo);

private void OnUserInfo(UserInfo userInfo)
{
    Debug.Log($&quot;user-info: {string.Join(&quot;,&quot;, userInfo.users)}, buff: {userInfo.buff.Length}&quot;);
}
</code></pre>

<p>By default any additional fields that present in the receiving type that has no corresponding field in the json going to be initialized to its default value. </p>
<p>Binary data can be sent alone too (Server):</p>
<pre><code class="language-csharp">socket.emit('binary', Buffer.from([9, 8, 7, 6, 5, 4, 3, 2, 1]));
</code></pre>

<p>(Client:)</p>
<pre><code class="language-csharp">manager.Socket.On&lt;byte[]&gt;(&quot;binary&quot;, OnBinaryMessage);

private void OnBinaryMessage(byte[] buffer)
{
    Debug.Log(&quot;OnBinaryMessage: &quot; + buffer.Length);
}
</code></pre>

<h3 id="inject-socketmanager-and-socket-as-callback-parameters">Inject SocketManager and Socket as callback parameters</h3>
<p>While the client parse the parameters it can inject the <code>SocketManager</code> or the receiving <code>Socket</code> instance (Server) into the parameter list:</p>
<pre><code class="language-csharp">socket.emit('binary', Buffer.from([9, 8, 7, 6, 5, 4, 3, 2, 1]));
</code></pre>

<p>(Client:)</p>
<pre><code class="language-csharp">manager.Socket.On&lt;SocketManager, Socket, byte[]&gt;(&quot;binary&quot;, OnBinaryMessage);

private void OnBinaryMessage(SocketManager manager, Socket socket, byte[] buffer)
{
    Debug.Log(&quot;OnBinaryMessage: &quot; + buffer.Length);
}
</code></pre>

<h3 id="acknowledgements">Acknowledgements</h3>
<p>With <code>ExpectAcknowledgement</code> we can set a callback that's going to be called (Client):</p>
<pre><code class="language-csharp">class ReturnVal
{
    public int code;
    public string msg;
}

manager.Socket.ExpectAcknowledgement&lt;ReturnVal&gt;(OnAcknowledgements).Emit(&quot;chat message&quot;, &quot;msg 1&quot;);

private void OnAcknowledgements(ReturnVal value)
{
    Debug.Log($&quot;{value.code}, '{value.msg}'&quot;);
}
</code></pre>

<p>(Server:)</p>
<pre><code class="language-csharp">socket.on('chat message', (msg, ack_callback) =&gt; {
    ack_callback({ code: 102, msg: 'ok ' + msg });
});
</code></pre>

<h3 id="special-events">Special Events</h3>
<p><code>connect</code> and <code>error</code> events are special as their type parameters are already defined. <code>connect</code> emits a <code>ConnectResponse</code> object that have only one field <code>sid</code>:</p>
<pre><code class="language-csharp">manager.Socket.On&lt;ConnectResponse&gt;(SocketIOEventTypes.Connect, OnConnected);

void OnConnected(ConnectResponse resp)
{
    Debug.Log(&quot;Connected sid: &quot; + resp.sid);
}
</code></pre>

<p>Specifying a different type parameter for connect will produce an error.</p>
<p>On the other hand, while <code>error</code> has a predefined <code>Error</code> type with a <code>message</code> property a new, custom error type can be created and used.</p>
<p>For example a server side middleware might want to send additional data other than just a plain text:</p>
<pre><code class="language-csharp">io.use((socket, next) =&gt; {
    const err = new Error(&quot;not authorized&quot;);
    err.data = { content: &quot;Please retry later&quot;, code: 101 };
    next(err);
});
</code></pre>

<pre><code class="language-csharp">class ErrorData
{
    public int code;
    public string content;
}

// Error already defines the message property
class CustomError : Error
{
    public ErrorData data;

    public override string ToString()
    {
        return $&quot;[CustomError {message}, {data?.code}, {data?.content}]&quot;;
    }
}

manager.Socket.On&lt;CustomError&gt;(SocketIOEventTypes.Error, OnError);

void OnError(CustomError args)
{
    Debug.LogError(string.Format(&quot;Error: {0}&quot;, args.ToString()));
}
</code></pre>

<h2 id="sending-events">Sending Events</h2>
<p>Sending an event can be done with the <code>Emit</code> function:</p>
<pre><code class="language-csharp">manager.Socket.Emit(&quot;chat message&quot;, &quot;msg 1&quot;);
</code></pre>

<p>Its first parameter is the name of the event, followed by any number of parameters.</p>
<h3 id="volatile-events">Volatile Events</h3>
<p>A <a href="https://socket.io/docs/v3/emitting-events/#Volatile-events">volatile event</a> isn't sent when the client can't send it right there. When no transport is ready to send a volatile event, instead of buffereing to send it later it's going to be discarded. An event can be marked as volatile by calling <code>Volatile()</code> on the socket first:</p>
<pre><code class="language-csharp">manager.Socket.Volatile().Emit(&quot;chat message&quot;, &quot;msg&quot;);
</code></pre>

<h2 id="namespaces">Namespaces</h2>
<p><code>SocketManager</code>'s <code>Socket</code> property is bound to the root ('/') namespace. Every subscription and event sent through this is sent to the root namespace. New namespaces can be accesses and connected to through the <code>GetSocket</code> function:</p>
<pre><code class="language-csharp">manager.GetSocket(&quot;/customNamespace&quot;).On(SocketIOEventTypes.Connect, OnNameSpaceConnected);
</code></pre>

<h2 id="rooms">Rooms</h2>
<p>Rooms are completely server-side features, no client support required!</p>
<h2 id="options">Options</h2>
<p>You can pass a SocketOptions instance to the SocketManager’s constructor. You can change the following options:</p>
<ul>
<li><strong>AdditionalQueryParams</strong>: Additional query parameters that will be passed for accessed uris. If the value is null, or an empty string it will be not appended to the query only the key. <em>The keys and values must be escaped properly, as the plugin will not escape these.</em></li>
</ul>
<pre><code class="language-csharp">SocketOptions options = new SocketOptions();
options.AdditionalQueryParams = new PlatformSupport.Collections.ObjectModel.ObservableDictionary&lt;string, string&gt;();
options.AdditionalQueryParams.Add(&quot;token&quot;, &quot;&lt; token value &gt;&quot;);

var manager = new SocketManager(new Uri(&quot;http://localhost:3000&quot;), options);
</code></pre>

<ul>
<li><strong>Reconnection</strong>: Whether to reconnect automatically after a disconnect. Its default value is true.</li>
<li><strong>ReconnectionAttempts</strong>: Number of attempts before giving up. Its default value is Int.MaxValue.</li>
<li><strong>ReconnectionDelay</strong>: How long to initially wait before attempting a new reconnection. Affected by +/- RandomizationFactor. For example the default initial delay will be between 500ms to 1500ms. Its default value is 1000ms.</li>
<li><strong>ReconnectionDelayMax</strong>: Maximum amount of time to wait between reconnections. Each attempt increases the reconnection delay along with a randomization as above. Its default value is 5000ms.</li>
<li><strong>RandomizationFactor</strong>: It can be used to control the ReconnectionDelay range. Its default value is 0.5 and can be set between the 0..1 values inclusive.</li>
<li><strong>Timeout</strong>: Connection timeout before a "connect_error" and "connect_timeout" events are emitted. It’s not the underlying tcp socket’s connection timeout, it’s for the socket.io protocol. Its default value is is 20000ms.</li>
<li><strong>AutoConnect</strong>: By setting this false, you have to call SocketManager's Open() whenever you decide it's appropriate.</li>
<li><strong>ConnectWith</strong>: The SocketManager will try to connect with the transport set to this property. It can be TransportTypes.Polling or TransportTypes.WebSocket.</li>
<li><strong>HTTPRequestCustomizationCallback</strong>: A callback that called for every <code>HTTPRequest</code> the socket.io protocol sends out. It can be used to further customize (add additional headers for example) requests. This callback is called for Websocket upgrade requests too on non-WebGL platforms.</li>
<li><strong>Auth</strong>: Connecting to a namespace a client can send payload data. When the Auth callback function is set, the plugin going to call it when connecting to a namespace. Its return value going to be serialized by the Parser.</li>
</ul>
<p>When you create a new SocketOptions object its properties are set to theirs default values.</p>
<pre><code class="language-csharp">SocketOptions options = new SocketOptions();
options.Auth = (manager, socket) =&gt; new { token = &quot;&lt;token&gt;&quot; };

var manager = new SocketManager(new Uri(&quot;http://localhost:3000&quot;), options);
</code></pre>

<h2 id="reconnection">Reconnection</h2>
<p>When there's a timeout or the transport disconnects from the server unintentionally the SocketOptions' Reconnection is true, the manager tries to reconnect to the server. Reconnect logic can be modified through SocketOptions.</p>
<h2 id="emitted-events">Emitted events</h2>
<p>All light blue rounded rectangles int this flow chart can be subscribed to:</p>
<p><img alt="Events Flowchart" src="media/events_flowchart.svg" /></p>
<p>As described above <code>connect</code> and <code>error</code> are special events witch means they have parameters. Other emitted events have no parameters (other than the possibility of injecting <code>SocketManager</code> and <code>Socket</code> instances):</p>
<pre><code class="language-csharp">manager.Socket.On(&quot;connecting&quot;, () =&gt; Debug.Log(&quot;connecting&quot;));
manager.Socket.On(&quot;reconnect&quot;, () =&gt; Debug.Log(&quot;reconnect&quot;));
manager.Socket.On(&quot;reconnecting&quot;, () =&gt; Debug.Log(&quot;reconnecting&quot;));
// ...
</code></pre>

<h2 id="parsers">Parsers</h2>
<p>By default the SocketManager uses a JSon parser and LitJson to encode/decode objects. It's also capable to send and receive MsgPack encoded messages if the server uses <a href="https://github.com/darrachequesne/socket.io-msgpack-parser">socket.io-msgpack-parser</a>.</p>
<p>To enable and use it, follow these steps:</p>
<ol>
<li>Download and import the <a href="https://assetstore.unity.com/packages/tools/network/json-messagepack-serialization-59918?aid=1101lfX8E">Json &amp; MessagePack Serialization</a> package</li>
<li>Create a new <a href="https://docs.unity3d.com/Manual/ScriptCompilationAssemblyDefinitionFiles.html">Asembly Definition file</a> under the <em>Plugins\GameDevWare.Serialization</em> folder</li>
<li>Locate the BestHTTP.asmdef file under the <em>Best HTTP</em> folder</li>
<li>
<p>Reference the newly create asmdef file and press Apply:</p>
<p><img alt="BestHTTP_AssemblyDefinition_MessagePack" src="media/BestHTTP_AssemblyDefinition_MessagePack.png" /></p>
</li>
<li>
<p>Add the <strong>BESTHTTP_SOCKETIO_ENABLE_GAMEDEVWARE_MESSAGEPACK</strong> define to the <a href="https://docs.unity3d.com/Manual/PlatformDependentCompilation.html">Scripting Define Symbols</a> input under <strong>PlayerSettings/Other Settings</strong>:</p>
<p><img alt="GameDevWare_MessagePack_ScriptingDefineSymbols.png" src="media/GameDevWare_MessagePack_ScriptingDefineSymbols.png" /></p>
</li>
<li>
<p>Use the now available <code>MsgPackParser</code> class:</p>
</li>
</ol>
<pre><code class="language-csharp">var manager = new SocketManager(new Uri(&quot;http://localhost:3000&quot;));
manager.Parser = new MsgPackParser();
</code></pre>

<p>The <code>MsgPackParser</code> class can be found in the <code>Best HTTP\Examples\Socket.IO3\Parsers\</code> folder.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../3.Socket.IO/" class="btn btn-neutral float-right" title="SocketIO">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../2.WebSocket/" class="btn btn-neutral" title="Index"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../2.WebSocket/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../3.Socket.IO/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>

</body>
</html>
